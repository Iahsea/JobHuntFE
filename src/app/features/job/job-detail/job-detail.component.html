<div class="w-full min-h-screen bg-white">
    @if (isLoading()) {
    <div class="flex flex-col items-center justify-center py-16 text-gray-500 animate-pulse">
        <div class="spinner-border text-blue-400"></div>
        <p class="text-lg font-medium mt-4">Đang tải thông tin công việc...</p>
    </div>
    } @else if (job()) {
    <!-- Breadcrumb -->
    <div class="w-full bg-white border-b border-gray-200 mt-24">
        <div class="max-w-6xl mx-auto px-4 py-4">
            <app-breadcrumb [items]="[
                    { label: 'Home', link: '/' },
                    { label: 'Companies', link: '/companies' },
                    { label: job()?.company?.name, link: '/companies/' + job()?.company?.id },
                    { label: job()?.name }
                ]"></app-breadcrumb>
        </div>
    </div>

    <!-- Header Card -->
    <div class="w-full py-16"
         style="background: #f8f8fd;">
        <div class="max-w-6xl mx-auto px-4">
            <div
                 class="flex flex-col md:flex-row items-stretch gap-6 bg-white rounded-2xl shadow-sm px-8 py-8 border border-gray-200 job-header-gradient">
                <!-- Logo -->
                <div
                     class="flex-shrink-0 bg-gradient-to-br bg-gray-50 rounded-2xl p-4 w-32 h-32 flex items-center justify-center">
                    <img [src]="job()?.logo || 'assets/images/default_job.png'"
                         [alt]="job()?.name"
                         class="w-20 h-20 object-contain"
                         width="80"
                         height="80"
                         loading="lazy"
                         decoding="async" />
                </div>

                <!-- Job Info -->
                <div class="flex-1 flex flex-col justify-center">
                    <h1 class="text-3xl font-bold text-gray-900 mb-3">{{ job()?.name }}</h1>
                    <div class="flex flex-wrap gap-6 text-sm text-gray-600 mb-4">
                        <div class="flex items-center gap-2">
                            <mat-icon class="text-blue-500 text-lg">apartment</mat-icon>
                            <div>
                                <div class="text-xs text-gray-500">Company</div>
                                <div class="font-semibold">{{ job()?.company?.name }}</div>
                            </div>
                        </div>
                        <div class="flex items-center gap-2">
                            <mat-icon class="text-blue-500 text-lg">location_on</mat-icon>
                            <div>
                                <div class="text-xs text-gray-500">Location</div>
                                <div class="font-semibold">{{ job()?.location }}</div>
                            </div>
                        </div>
                        <div class="flex items-center gap-2">
                            <mat-icon class="text-blue-500 text-lg">schedule</mat-icon>
                            <div>
                                <div class="text-xs text-gray-500">Job Type</div>
                                <div class="font-semibold">Full-Time</div>
                            </div>
                        </div>
                        @if (job()?.salary) {
                        <div class="flex items-center gap-2">
                            <mat-icon class="text-blue-500 text-lg">payments</mat-icon>
                            <div>
                                <div class="text-xs text-gray-500">Salary</div>
                                <div class="font-semibold">{{ job()?.salary | currency:'VND':'symbol':'1.0-0' }}</div>
                            </div>
                        </div>
                        }
                    </div>
                </div>

                <!-- Apply Button -->
                <div class="flex-shrink-0 flex items-center justify-center">
                    <button (click)="applyJob()"
                            class="apply-now-animated px-8 py-3 rounded-xl text-base shadow-md">
                        <span>Apply Now</span>
                        <mat-icon class="apply-arrow text-lg align-middle">arrow_forward</mat-icon>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Content Area -->
    <div class="w-full bg-white py-8">
        <div class="max-w-6xl mx-auto px-4">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <!-- Left Column: Description + Responsibilities + Who You Are -->
                <div class="lg:col-span-2 space-y-8">
                    <div>
                        <h2 class="text-2xl font-bold text-gray-900 mb-4">Description</h2>
                        <div class="text-gray-700 leading-relaxed space-y-4"
                             [innerHTML]="job()?.description"></div>
                    </div>
                    <div>
                        <h2 class="text-2xl font-bold text-gray-900 mb-4">Responsibilities</h2>
                        <div class="text-gray-700 leading-relaxed space-y-2"
                             [innerHTML]="job()?.requirements"></div>
                    </div>
                    @if (job()?.benefits) {
                    <div>
                        <h2 class="text-2xl font-bold text-gray-900 mb-4">Who You Are</h2>
                        <div class="text-gray-700 leading-relaxed space-y-2"
                             [innerHTML]="job()?.benefits"></div>
                    </div>
                    }
                </div>

                <!-- Right Column: About this role -->
                <div>
                    <div class="about-role-card bg-white rounded-xl p-6 border border-gray-200">
                        <h2 class="about-role-title mb-6">About this role</h2>
                        <!-- Progress bar -->
                        <div class="about-role-progress mb-6">
                            <div class="flex items-center mb-1">
                                <span class="font-semibold text-indigo-700">5 applied</span>
                                <span class="text-gray-400 ml-1">of 10 capacity</span>
                            </div>
                            <div class="progress-bar-outer">
                                <div class="progress-bar-inner"></div>
                            </div>
                        </div>
                        <div class="about-role-list">
                            <div class="about-role-row">
                                <span>Apply Before</span>
                                <span class="about-role-value">{{ job()?.startDate ? (job()?.startDate |
                                    date:'yyyy-MM-dd') : '' }}</span>
                            </div>
                            <div class="about-role-row">
                                <span>Job Posted On</span>
                                <span class="about-role-value">
                                    {{ job()?.endDate ? (job()?.endDate | date:'yyyy-MM-dd') : '' }}
                                </span>
                            </div>
                            <div class="about-role-row">
                                <span>Work Mode</span>
                                <span class="about-role-value">{{ job()?.workMode }}</span>
                            </div>
                            <div class="about-role-row">
                                <span>Salary</span>
                                <span class="about-role-value font-bold">
                                    {{ job()?.salary | currency:'VND':'symbol':'1.0-0' }}
                                </span>
                            </div>
                        </div>
                        <hr class="about-role-divider my-6" />
                        <div>
                            <h3 class="about-role-section mb-3">Job Type</h3>
                            <div class="flex flex-wrap gap-2">
                                <span class="about-role-badge about-role-badge-yellow">{{ job()?.jobType }}</span>
                            </div>
                        </div>
                        <hr class="about-role-divider my-6" />
                        <div>
                            <h3 class="about-role-section mb-3">Level</h3>
                            <div class="flex flex-wrap gap-2">
                                <span class="about-role-badge about-role-badge-green">{{ job()?.level }}</span>
                            </div>
                        </div>
                        <hr class="about-role-divider my-6" />
                        <div>
                            <h3 class="about-role-section mb-3">Required Skills</h3>
                            <div class="about-role-skills">
                                @for (skill of job()?.skills ?? []; track skill.id) {
                                <span class="about-role-skill">{{ skill.name }}</span>
                                }
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Company Information Section -->
    <div class="w-full bg-white company-info-section">
        <div class="max-w-6xl mx-auto px-2">
            <div class=" company-info-card">
                <!-- new wrapper: left (logo + name + description) and right (single image) -->
                <div class="company-info-content flex flex-col md:flex-row md:items-stretch py-20 gap-8">
                    <!-- Left: Logo, Name, Link, Description (all together) -->
                    <div class="company-info-left flex-1 flex flex-col justify-center min-w-[320px] max-w-[520px]">
                        <div class="flex items-center gap-4 mb-3">
                            <div class="company-info-logo flex-shrink-0">
                                <img [src]="job()?.company?.logo || 'assets/images/default_company.png'"
                                     [alt]="job()?.company?.name"
                                     class="w-14 h-14 object-contain"
                                     width="56"
                                     height="56"
                                     loading="lazy"
                                     decoding="async" />
                            </div>
                            <div>
                                <div class="text-2xl font-bold text-gray-900 mb-0.5">
                                    {{ job()?.company?.name }}
                                </div>
                                <a [routerLink]="['/companies', job()?.company?.id]"
                                   class="company-info-link text-blue-600 hover:text-blue-700 font-medium text-base">
                                    Read more about {{ job()?.company?.name }}
                                    <mat-icon class="text-lg">arrow_forward</mat-icon>
                                </a>
                            </div>
                        </div>

                        <!-- Company Description now inside same left column -->
                        <div class="company-description text-gray-700 leading-relaxed text-base mt-2 line-clamp-2"
                             [title]="job()?.company?.description">
                            {{ job()?.company?.description }}
                        </div>
                    </div>

                    <!-- Right: Single image (use coverImage or fallback) -->
                    <div class="company-single-image-wrapper">
                        <img [src]="job()?.company?.coverImage || 'assets/images/default_company_cover.jpg'"
                             alt="{{ job()?.company?.name }} image"
                             class="w-full h-full object-cover"
                             loading="lazy" />
                    </div>
                </div>
            </div>
        </div>
    </div>
    }
</div>